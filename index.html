<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Invaders</title>
</head>

<body>
    <canvas id="my_canvas" width="900" height="900"></canvas>

    <script src="player.js"></script>
    <script src="enemy.js"></script>
    <script src="wall.js"></script>
    <script src="bullet.js"></script>
    <script type="text/javascript">
        const my_canvas = document.getElementById('my_canvas');
        const ctx = my_canvas.getContext('2d');
        my_canvas.style.left = "500px";
        my_canvas.style.top = "20px";
        my_canvas.style.position = "absolute";

        var flag = 0;
        var pressed = 0;

        let y = 450;
        let x = 450;

        var points = 0;

        var baluchaPrueba = 0;

        var speed = 0;

        var direction = "";

        var walls = [];

        var pause = false;

        var posicionY = 0;
        var posicionX = 0;

        var imagen = new Image();
        imagen.src = "dog.png";

        const ding = new Audio('dog.mp3');

        document.addEventListener("keydown", function (e) {
            console.log(e)

            switch (e.keyCode) {
                case 37:
                    direction = "left";
                    break;
                case 39:
                    direction = "right";
                    break;
                case 32:
                    direction = "space";
                    //pause = !pause;
                    baluchaPrueba = 1;
                    posicionY = player.y;
                    posicionX = player.x;
                    break;
            }
        })

        function update() {
            //cuando pongas el pause de nuevo es pause aqui, sin !
            if (!pause) {
                switch (direction) {
                    case "left":
                        if (speed > 3) {
                            player.x = player.x - 3 - speed;
                        } else {
                            player.x = player.x - 3;
                        }
                        if (player.x <= -40) {
                            player.x = 900;
                        }
                        break;
                    //borrar en caso de 
                    case "up":
                        if (speed > 3) {
                            player.y = player.y - 3 - speed;
                        } else {
                            player.y = player.y - 3;
                        }
                        if (player.y <= -40) {
                            player.y = 630;
                        }
                        break;
                    case "right":
                        if (speed > 3) {
                            player.x = player.x + 3 + speed;
                        } else {
                            player.x = player.x + 3;
                        }
                        if (player.x >= 900) {
                            player.x = -40;
                        }
                        break;
                    //borrar en caso de 
                    case "down":
                        if (speed > 3) {
                            player.y = player.y + 3 + speed;
                        } else {
                            player.y = player.y + 3;
                        }
                        if (player.y >= 600) {
                            player.y = -40;
                        }
                        break;
                }
            }

            if (bala.hit(enemy)) {
                enemy.x = Math.random() * 900;
                enemy.y = Math.random() * 900;

                points = points + 10;
            }

            function muros(walls, i, arr) {
                if (player.hit(walls)) {
                    switch (direction) {
                        case "left":
                            player.x = player.x + 3;
                            break;
                        case "up":
                            player.y = player.y + 3;
                            break;
                        case "right":
                            player.x = player.x - 3;
                            break;
                        case "down":
                            player.y = player.y - 3;
                            break;
                    }
                }
            }

            walls.forEach(muros)
        }

        function pintar() {
            ctx.fillStyle = "lightblue";
            ctx.fillRect(0, 0, 900, 900);

            ctx.drawImage(imagen, player.x, player.y, player.w, player.h)

            ctx.fillStyle = enemy.c;
            ctx.fillRect(enemy.x, enemy.y, enemy.w, enemy.h);
            ctx.strokeRect(enemy.x, enemy.y, enemy.w, enemy.h);

            if(baluchaPrueba === 1){
                ctx.fillStyle = bala.c;
                ctx.fillRect(posicionX,posicionY,bala.w, bala.h);
                ctx.strokeRect(posicionX,posicionY,bala.w, bala.h);

                posicionY -=5;

                if (posicionY < -bala.h) {
                    baluchaPrueba = 0; 
                }
            }

            function muros(walls, i, arr) {
                ctx.fillStyle = walls.c;
                ctx.fillRect(walls.x, walls.y, walls.w, walls.h);
                ctx.strokeRect(walls.x, walls.y, walls.w, walls.h);
            }

            walls.forEach(muros)

            ctx.font = "20px Verdana";
            ctx.strokeText("Puntos: " + points, 450, 50);

            //cuando pongas el pause de nuevo es !pause
            if (pause) {
                ctx.fillStyle = "rgba(255, 0, 0, 0.5)";
                ctx.fillRect(0, 0, 900, 900);

                ctx.font = "40px Verdana";
                ctx.strokeText("PAUSONA", 900, 900);
            }

            update();
            requestAnimationFrame(pintar);
        }

        requestAnimationFrame(pintar);

        var bala = new Bullet(0, 0, 10, 10, "red", 10)

        var player = new Player(450, 800, 50, 50, "white", 10);
        var enemy = new Enemy(450, 450, 200, 20, "red", 10);

        walls.push(new Wall(200, 400, 200, 20, "grey", 10));
        walls.push(new Wall(200, 100, 200, 20, "grey", 10));

    </script>
    <style>
        canvas {
            background-color: lightblue;
        }
    </style>
</body>

</html>