<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Invaders</title>
</head>

<body>
    <canvas id="my_canvas" width="900" height="900"></canvas>

    <script src="player.js"></script>
    <script src="enemy.js"></script>
    <script src="wall.js"></script>
    <script src="bullet.js"></script>
    <script type="text/javascript">
        const my_canvas = document.getElementById('my_canvas');
        const ctx = my_canvas.getContext('2d');
        my_canvas.style.left = "500px";
        my_canvas.style.top = "20px";
        my_canvas.style.position = "absolute";

        var flag = 0;
        var pressed = 0;

        let y = 450;
        let x = 450;

        var points = 0;

        var baluchaPrueba = 0;
        var ammo = 5;

        var speed = 0;

        var direction = "";

        var walls = [];
        var enemies = [];

        var pause = false;

        var posicionY = 0;
        var posicionX = 0;

        var derechaPlayer = 0;
        var playerDerecha = new Image();
        playerDerecha.src = "files/player/player_Derecha.png";

        var izquierdaPlayer = 0;
        var playerIzquierda = new Image();
        playerIzquierda.src = "files/player/player_Izquierda.png";

        var playerParado = new Image();
        playerParado.src = "files/player/player_Parado.png";

        var playerDisparo = 0;
        var playerDisparando = new Image();
        playerDisparando.src = "files/player/player_Disparando.png";

        var balazo = new Image();
        balazo.src = "files/bala/bala.png";
        
        var disparoPlayer = 0;

        var hueso = new Image();
        hueso.src = "files/hueso.png";

        const grass = new Image();
        grass.src = 'files/grass.jpg';

        const fondo = new Image();
        fondo.src = 'files/fondo.png';

        const fondo2 = new Image();
        fondo2.src = 'files/prueba.jpg';

        let enemigosImgs = [
            new Image(),
            new Image(),
            new Image(),
            new Image(),
            new Image(),
        ];

        enemigosImgs[0].src = 'files/zombie/gordo.png';
        enemigosImgs[1].src = 'files/zombie/flaco.png'; 
        enemigosImgs[2].src = 'files/zombie/morro.png';
        enemigosImgs[3].src = 'files/zombie/torrera.png';
        enemigosImgs[4].src = 'files/zombie/sentado.png';

        const ding = new Audio('files/dog.mp3');

        document.addEventListener("keydown", function (e) {
            console.log(e)

            switch (e.keyCode) {
                case 37:
                case 65:
                    direction = "left";
                    izquierdaPlayer = 1;
                    break;
                case 39:
                case 68:
                    direction = "right";
                    izquierdaPlayer = 0;
                    derechaPlayer = 1;
                    break;
                case 32:
                    izquierdaPlayer = 0;
                    derechaPlayer = 0;
                    playerDisparo = 1;
                    if(baluchaPrueba === 1 || ammo === 0){
                        console.log("no")
                    }else{
                        direction = "space";
                        //pause = !pause;
                        baluchaPrueba = 1;
                        ammo -= 1;
                        posicionY = player.y;
                        posicionX = player.x;
                    }
                    break;
            }
        })

        function update() {
            //cuando pongas el pause de nuevo es pause aqui, sin !
            if (!pause) {
                switch (direction) {
                    case "left":
                        if (speed > 3) {
                            player.x = player.x - 3 - speed;
                        } else {
                            player.x = player.x - 3;
                        }
                        if (player.x <= -40) {
                            player.x = 900;
                        }
                        break;
                    //borrar en caso de 
                    case "up":
                        if (speed > 3) {
                            player.y = player.y - 3 - speed;
                        } else {
                            player.y = player.y - 3;
                        }
                        if (player.y <= -40) {
                            player.y = 630;
                        }
                        break;
                    case "right":
                        if (speed > 3) {
                            player.x = player.x + 3 + speed;
                        } else {
                            player.x = player.x + 3;
                        }
                        if (player.x >= 900) {
                            player.x = -40;
                        }
                        break;
                    //borrar en caso de 
                    case "down":
                        if (speed > 3) {
                            player.y = player.y + 3 + speed;
                        } else {
                            player.y = player.y + 3;
                        }
                        if (player.y >= 600) {
                            player.y = -40;
                        }
                        break;
                }
            }

            if (baluchaPrueba === 1) {
                posicionY -= 5; 
                bala.x = posicionX; 
                bala.y = posicionY; 
        
                if (posicionY < -bala.h) {
                    baluchaPrueba = 0; 
                }
            }

            function enemigos(enemies, j,array){
                if (bala.hit(enemies)) {
                    enemies.x = 1800; 
                    enemies.y = 1800;
                    points += 10;
                    baluchaPrueba = 0;
                }
            }

            function muros(walls, i, arr) {
                if (player.hit(walls)) {
                    switch (direction) {
                        case "left":
                            player.x = player.x + 3;
                            break;
                        case "up":
                            player.y = player.y + 3;
                            break;
                        case "right":
                            player.x = player.x - 3;
                            break;
                        case "down":
                            player.y = player.y - 3;
                            break;
                    }
                }
                if (bala.hit(walls)) {
                    baluchaPrueba = 0;
                }
            }

            walls.forEach(muros)
            enemies.forEach(enemigos)
        }

        function pintar() {
            ctx.drawImage(fondo2, 0, 0, my_canvas.width, my_canvas.height);

            ctx.drawImage(playerParado, player.x, player.y, player.w, player.h)

            if(izquierdaPlayer === 1){
                ctx.drawImage(playerIzquierda, player.x, player.y, player.w, player.h)
            } else if(derechaPlayer === 1){
                ctx.drawImage(playerDerecha, player.x, player.y, player.w, player.h)
            }else if(playerDisparo === 1){
                ctx.drawImage(playerDisparando, player.x, player.y, player.w, player.h)
            }
            
            enemies.forEach(enemy => {
                enemy.draw(ctx);
            });

            if(baluchaPrueba === 1){
                ctx.drawImage(balazo, bala.x, bala.y, bala.w, bala.h);
                posicionY -=5;

                if (posicionY < -bala.h) {
                    baluchaPrueba = 0; 
                }
            }

            function muros(walls, i, arr) {
                ctx.fillStyle = walls.c;
                ctx.fillRect(walls.x, walls.y, walls.w, walls.h);
                ctx.strokeRect(walls.x, walls.y, walls.w, walls.h);
            }

            walls.forEach(muros)
        
            ctx.font = "20px Verdana";
            ctx.strokeText("Puntos: " + points, 450, 50);

            //cuando pongas el pause de nuevo es !pause
            if (pause) {
                ctx.fillStyle = "rgba(255, 0, 0, 0.5)";
                ctx.fillRect(0, 0, 900, 900);

                ctx.font = "40px Verdana";
                ctx.strokeText("PAUSONA", 900, 900);
            }

            update();
            requestAnimationFrame(pintar);
        }

        requestAnimationFrame(pintar);

        var bala = new Bullet(0, 0, 15, 15, "red", 10)

        var player = new Player(450, 800, 30, 30, "white", 10);

        let cols = 10;  
        let rows = 5;   
        let enemyWidth = 20; 
        let enemyHeight = 20; 
        let xSpacing = (900 - (cols * enemyWidth)) / (cols + 1); 

        for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
                let xPos = xSpacing + col * (enemyWidth + xSpacing); 
                let yPos = 50 + row * (enemyHeight + 50); 
                enemies.push(new Enemy(xPos, yPos, enemyWidth, enemyHeight, "red", 10));
            }
        }

        //walls.push(new Wall(200, 400, 200, 20, "grey", 10));
        //walls.push(new Wall(200, 100, 200, 20, "grey", 10));

    </script>
    <style>
        canvas {
            background-color: lightblue;
        }
        body {
            background-image: url("files/fondo.png");
          }
    </style>
</body>

</html>